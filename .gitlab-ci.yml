image:
  name: docker:latest

services:
  - docker:dind

before_script:
  - apk add curl

stages:
  - test

test-job:
  stage: test
  script:
    - docker compose -f compose.yaml -f compose.php.yaml build --pull
    - docker compose -f compose.yaml -f compose.php.yaml up --wait --no-build
    - docker compose exec php php bin/console oro:install --env=test
    - curl -v -o /dev/null http://localhost
    - curl -vk -o /dev/null https://localhost
    - docker compose exec -T php bin/phpunit vendor/oro/commerce/src/Oro/Bundle/ProductBundle/Tests/Unit
    - docker compose exec -T php bin/phpunit vendor/oro/commerce/src/Oro/Bundle/ProductBundle/Tests/Functional
